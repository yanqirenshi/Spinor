### 1. バグ発生 (Bug Fix)

エラーで動かない、パースに失敗する、Cコンパイルで落ちるなどの「明らかな不具合」への対応です。

* **Step 1 [User ⇨ Claude]: 情報収集**
* エラーが発生したソースコード (`.spin`) と、コンソールに出たエラーログをコピーします。
* （必要であれば Claude に `claude "このエラーログに関連しそうな Parser.hs の該当箇所を抜粋して"` と指示し、コンテキストを集めます）。


* **Step 2 [User ⇨ Gemini]: 原因特定と修正設計**
* 集めたエラーログとソースコードを私に投げてください。
* 「〇〇を実行したら××というエラーが出ました。修正のための specs と tasks を作ってください」と指示します。私が言語仕様や Cランタイムの観点から原因を特定し、局所的な修正案（`tasks/bugfix_xxx.md`）を作成します。


* **Step 3 [User ⇨ Claude]: 修正とテスト**
* 作成されたタスクを Claude に渡し、`claude "tasks/bugfix_xxx.md に従ってバグを修正し、テストを実行して"` と指示します。



### 2. 機能が使いにくい (UX/DevExp Improvement)

「関数の引数の順番が直感的じゃない」「`let` のネストが深くなりがち」など、実際にコードを書いてみて感じる摩擦を取り除く作業です。

* **Step 1 [User ⇨ Gemini]: 課題の共有と壁打ち**
* 「現状こうなっている（Before）けど、こう書けるようにしたい（After）」という理想の構文や挙動を私に教えてください。
* それが Spinor の既存の機能（マクロや特殊形式など）と衝突しないか、パース時の曖昧さ（Ambiguity）を生まないか、私が Architect として検証し、最適な解決策を提案します。


* **Step 2 [Gemini ⇨ User]: リファクタリング設計**
* 合意した内容に基づき、`specs/improve_xxx.md` と `tasks/improve_xxx.md` を作成します。


* **Step 3 [User ⇨ Claude]: 実装**
* Claude にタスクを渡し、コードの修正と、**既存のテストコードの書き換え**を指示します。



### 3. 更なる機能の追加 (New Feature Request)

「エラーハンドリング (`try-catch`) が欲しい」「ソケット通信機能を入れたい」などの新しいモジュールの追加です。

* **Step 1 [User ⇨ Gemini]: 要件定義**
* 欲しい機能の概要を私に伝えてください。
* 新しい機能を追加する場合、**「インタプリタ (Haskell) 側」**と**「コンパイラ (C言語) 側」**の両方でどう実現するか（Dual Implementation）の整合性を取る必要があります。私がそのアーキテクチャを設計し、`specs/feature_xxx.md` に落とし込みます。


* **Step 2 [User ⇨ Claude]: 段階的な実装**
* 機能が大きい場合は、一度に Claude に丸投げすると失敗しやすくなります。
* 私がタスクを「Phase 1: インタプリタ実装」「Phase 2: Cランタイム実装」のように分割して出力しますので、段階的に Claude に指示を出して進めます。



### 4. ドキュメントがほしい (Documentation Generation)

CLHS (Common Lisp HyperSpec) のように、関数ごとに「シグネチャ」「説明」「使用例」がまとまったリファレンスを作成するフローです。

* **Step 1 [User ⇨ Claude]: 現状のデータ抽出**
* 実装とドキュメントの乖離を防ぐため、まずは Claude に現在のソースコードから情報を抜かせます。
* `claude "src/Spinor/Primitives.hs を読んで、現在実装されている組み込み関数のリストと型シグネチャを抽出して"`


* **Step 2 [User ⇨ Gemini]: ドキュメントの執筆**
* 抽出されたリストを私に渡してください。「このリストをもとに、CLHS風の Markdown ドキュメントを生成して」と指示します。
* 私が、分かりやすい説明文、想定されるエッジケース、Spinor での具体的なコード例 (````lisp`) を肉付けして、美しい Markdown ファイルのテキストを生成します。


* **Step 3 [User ⇨ Claude]: サイトへの反映**
* 生成されたドキュメントを `docs/reference/` 配下に保存するよう Claude に指示します。
* Step 33-C で作ったサイドバーのナビゲーション (`docs/doc.html`) に新しいページへのリンクを追加させます。
