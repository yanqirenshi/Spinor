# Experimental: Linear Types & Ownership Specification

## 1. 概要
Spinor に線形型 (Linear Types) と所有権 (Ownership) の概念を導入し、静的な解析によってメモリの生存期間を特定する。これにより、C 言語へのトランスパイル時に適切なタイミングで `free()` を自動挿入し、GC なしでのメモリ安全性を実現する。

## 2. データモデルと型システム

### 2.1 所有権の定義
変数の状態を以下の 3 つに分類する：
- **Owned (所有):** 値の所有権を持ち、スコープの終わりで解放する責任がある。他へ渡すと「ムーブ」される。
- **Borrowed (借用):** 値への参照のみを持ち、解放の責任はない。
- **Linear (線形):** 必ず「一度だけ」消費されなければならない特別な状態。

### 2.2 型表現の拡張
`Type` データ型に、線形性を表す修飾子を追加する設計。
- `LType Linearity Type`: 
    - `Linear`: 一度だけ使用。
    - `Unrestricted`: 従来通りの制限なし。

### 2.3 AST (`Expr`) の拡張
`ESym` および `ELet` 等に、コンパイラが解析結果を付与するためのメタデータフィールドを追加することを検討する。

## 3. 所有権チェッカー (Borrow Checker) の仕組み

### 3.1 線形性の検証
`Infer.hs` の後に実行されるパスとして実装する。
- 変数が定義された後、その変数が「消費」される箇所を追跡する。
- **Move:** 関数引数として渡す、あるいは新しい変数に代入すると、元の変数は使用不能になる。
- **Error:** 未消費のままスコープを抜ける、または 2 回以上使用された場合に `SpinorError` を発生させる。

## 4. コンパイラ (C バックエンド) の統合

### 4.1 自動解放 (`free`) の挿入
解析によって「所有権がこのスコープで終わる」と判定された変数に対し、C コード生成時に `free(var)` を自動的に挿入する。

## 5. ドキュメント
- `manual/public/docs/syntax/ownership.md` を作成。
- サイドバー (`Sidebar.tsx`) の新しいカテゴリ「Experimental」に追加。
