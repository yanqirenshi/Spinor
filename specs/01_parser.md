# Spinor パーサー仕様

## 1. 概要

Spinor のパーサーは、S式 (S-expression) 形式のテキストを読み込み、Spinor の内部表現である抽象構文木 (AST) に変換する責務を負う。

## 2. データ型

パーサーは以下のデータ型を認識し、対応する `Expr` 型のコンストラクタに変換する。

| データ型 | `Expr` コンストラクタ | 説明 |
| :--- | :--- | :--- |
| 整数 | `EInt Integer` | 10進数の整数。正負の値をサポートする。 |
| 真偽値 | `EBool Bool` | `#t` (真) または `#f` (偽) の2つのリテラルを持つ。 |
| 文字列 | `EStr Text` | ダブルクォーテーションで囲まれた文字列。 |
| シンボル | `ESym Text` | Lisp のアトムとして機能する識別子。英数字と一部の記号から構成される。 |
| リスト | `EList [Expr]` | 0個以上の `Expr` を含む、括弧で囲まれたシーケンス。 |

## 3. 構文

### 3.1. S式

基本的な構文はS式に従う。データはアトムまたはリストとして表現される。

```scheme
; これはコメントです
(define (add x y)
  (+ x y))
```

### 3.2. リテラル

*   **整数**: `123`, `0`, `-45`
*   **真偽値**: `#t`, `#f`
*   **文字列**: `"hello"`, `"hello\nworld"`
*   **シンボル**:
    *   空白、括弧 `()`, コメント文字 `;`, ダブルクォート `"` を含まない連続した文字列。
    *   例: `x`, `list`, `+`, `string->number`
*   **リスト (S式)**:
    *   丸括弧 `()` で囲まれ、空白で区切られた0個以上の要素を持つ。
    *   例: `()`, `(1 2 3)`, `(a #t (b c))`

### 3.3. 糖衣構文 (Syntactic Sugar)

*   **Quote**: シングルクォーテーション `'` を式の前に置くと、その式を `quote` したリストに展開される。
    *   `'foo` は `(quote foo)` と等価である。
    *   `'(a b)` は `(quote (a b))` と等価である。

### 3.4. 空白とコメント

*   **空白**: スペース、タブ、改行は、トークン間の区切り文字として扱われ、無視される。
*   **コメント**: セミコロン `;` からその行の終わりまではコメントとして扱われ、パーサーによって無視される。

## 4. パース処理

*   パーサーは `megaparsec` ライブラリを使用して実装される。
*   パース処理は、まず空白とコメントをスキップし、その後で各式のリテラル表現を解釈する。
*   パースのエントリーポイントは、単一の `Expr`、または複数の `Expr` を含むリストを返す関数として提供される。
