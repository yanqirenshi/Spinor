# Spec 41: Content Architecture & DocGen Integration

## 1. Overview

Step 39 で作成した Haskell 製ドキュメントジェネレーター (`DocGen.hs`) の出力を、Step 40 で構築した React マニュアルサイト (`manual/`) に統合する。
静的なドキュメント (Introduction など) と、`DocGen.hs` が生成する動的な API リファレンスが、単一の SPA 内でシームレスに連携するコンテンツアーキテクチャを確立する。

## 2. DocGen.hs Modifications

`DocGen.hs` の機能は維持しつつ、React アプリケーションとの統合のために出力形式と場所を以下のように改修する。

### 2.1. Output Directory

- **Base Directory:** ドキュメントの出力先を `docs/` から `manual/public/` に変更する。これにより、Vite の開発サーバーがファイルを直接配信できるようになる。
- **API Reference Files:** 個別の API ドキュメント (`.md`) は `manual/public/ref/` ディレクトリに出力する。
- **Index File:** API のインデックスファイルは `manual/public/docs/api-index.md` として出力する。

### 2.2. Link Format

インデックスファイル (`api-index.md`) 内の各 API へのリンク形式を、React Router が解釈できる形式に変更する。

- **旧形式:** `doc.html?src=ref/<slug>.md`
- **新形式:** `/docs/ref/<slug>`

## 3. React Application Architecture

### 3.1. Routing Strategy

現在の `/docs/:slug` というルーティングでは、`/docs/ref/add` のようなネストしたパス構造を効率的に扱えない。
これを解決するため、ワイルドカード (Splat) ルートを導入する。

- **新ルート:** `/docs/*`

このルートは `/docs/` 以下のすべてのパスにマッチし、単一の `MarkdownViewer` コンポーネントで処理を共通化する。

### 3.2. Dynamic Content Fetching

`MarkdownViewer.tsx` は、URL のワイルドカード部分を取得し、それを基に対応する Markdown ファイルを `fetch` する。

- **URL:** `http://.../docs/ref/add`
- **`useParams`:** `*` (ワイルドカード) の値として `ref/add` を取得。
- **`fetch`:** `/ref/add.md` をリクエスト。 (Vite の `public` ディレクトリがルート `/` として扱われるため)

このアーキテクチャにより、コンテンツのパス構造と URL が直感的に対応する。

## 4. Content Structure

`manual/public/` ディレクトリは、以下の構造で静的コンテンツと生成コンテンツを管理する。

```
manual/public/
├── docs/
│   ├── api-index.md      # (Generated by DocGen.hs)
│   ├── introduction.md     # (Static)
│   └── syntax.md           # (Static)
└── ref/
    ├── add.md              # (Generated by DocGen.hs)
    ├── sub.md              # (Generated by DocGen.hs)
    └── ...
```

## 5. Sidebar Navigation

`Sidebar.tsx` は、主要なドキュメントへのエントリーポイントとして機能する。以下の静的・動的コンテンツへのリンクを提供する。

- `/docs/introduction`
- `/docs/syntax`
- `/docs/api-index` (API リファレンスの目次へ)
